<mat-card [formGroup]="group">
	<mat-card-header class="flex justify-between mb-4">
		<h1 mat-card-title>{{ value?._id ? 'Edit' : 'New' }} invoice</h1>
		<mat-checkbox class="ms-auto" labelPosition="before" formControlName="estimate">Estimate</mat-checkbox>
	</mat-card-header>
	<mat-card-content class="flex! flex-col mb-4">
		<mat-accordion [multi]="false">
			<mat-expansion-panel hideToggle [disabled]="!groupMissions.length" #formPanel>
				<mat-expansion-panel-header>
					<h3 [hidden]="!formPanel.expanded">{{ missionLabel }}</h3>
					<div class="flex flex-col grow" [hidden]="formPanel.expanded" *lvLoading="pending; color: 'accent'; diameter: 32; classes: ['my-4']">
						<mat-selection-list multiple class="flex! flex-wrap mb-2" [compareWith]="idComparator"
							formControlName="missions">
							@for (mission of missionList; track mission._id) {
							<mat-list-option class="w-min!" [value]="mission" [disabled]="mission.disabled"
								(click)="$event.stopPropagation()">
								{{ mission.name }}
							</mat-list-option>
							}
						</mat-selection-list>
						<div class="inline-flex items-center justify-center" [hidden]="!groupMissions.length">
							<hr class="w-5/6 h-1 my-4 border-0 rounded-sm bg-primary">
							<div class="absolute flex items-center rounded-b-2xl px-3 bg-surface bg-default">
								<mat-icon class="lv-accent">keyboard_double_arrow_down</mat-icon>
							</div>
						</div>
					</div>
				</mat-expansion-panel-header>
				<ng-template matExpansionPanelContent>
					<lv-invoice-form [value]="value" [group]="group" (addLine)="lineAdd()"
						(removeLine)="lineRemove($event)"></lv-invoice-form>
				</ng-template>
			</mat-expansion-panel>
			<mat-expansion-panel hideToggle [expanded]="generatorExpanded" [disabled]="!groupGenerate"
				[hidden]="!groupMissions.length" #genPanel>
				<mat-expansion-panel-header>
					<mat-panel-title>Generate</mat-panel-title>
					<mat-panel-description class="justify-end!">
						<mat-checkbox formControlName="generate" (change)="updateGeneratePanel($event, genPanel)"
							(click)="$event.stopPropagation()">Enabled</mat-checkbox>
					</mat-panel-description>
				</mat-expansion-panel-header>
				<lv-invoice-generator [group]="group" (lineAdded)="lineAdd($event)"
					(lineRemoved)="lineRemove($event)" (lineReset)="lineReset()"></lv-invoice-generator>
			</mat-expansion-panel>
		</mat-accordion>
	</mat-card-content>
	<mat-card-actions class="duo">
		<button mat-stroked-button class="lv-error" [disabled]="pending" (click)="cancel()">
			Cancel
		</button>
		<button mat-raised-button class="lv-accent" [disabled]="pending || group.invalid || group.pending"
			(click)="submit()">
			Submit
		</button>
	</mat-card-actions>
</mat-card>
